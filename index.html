<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PROTOTYPE ‚Ä¢ TikTok-Style Infinite Product Feed</title>
  <!-- Reliability: preconnect for image CDN -->
  <link rel="preconnect" href="https://images.unsplash.com" crossorigin>
  <link rel="dns-prefetch" href="//images.unsplash.com">
  <style>
    :root {
      --bg:#0f0f10; --card:#141416; --text:#eaeaea; --muted:#9aa0a6; --accent:#10b981; --danger:#ef4444; --proto:#f59e0b;
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    header{position:sticky; top:0; z-index:10; backdrop-filter:saturate(180%) blur(8px); background:linear-gradient(180deg, rgba(20,20,22,.95), rgba(20,20,22,.6)); border-bottom:1px solid #222; display:flex; align-items:center; gap:.75rem; padding:.8rem 1rem}
    header .logo{font-weight:800; letter-spacing:.2px}
    header .badge{margin-left:auto; font-size:.8rem; color:var(--muted)}
    header .proto-tag{margin-left:.5rem; font-weight:800; color:var(--proto)}

    .hero{max-width:1100px; margin:0 auto; display:grid; gap:2rem; padding:2.5rem 1.5rem 1.5rem; align-items:center}
    .hero-content h1{margin:0 0 .75rem; font-size:clamp(1.8rem,3vw,2.6rem); font-weight:800}
    .hero-content p{margin:0 0 1rem; color:var(--muted); line-height:1.6}
    .hero-highlights{list-style:none; margin:0; padding:0; display:grid; gap:.5rem}
    .hero-highlights li{background:rgba(16,185,129,.14); border:1px solid rgba(16,185,129,.28); border-radius:999px; padding:.55rem 1rem; font-weight:600; color:#b6f5d8}
    .hero-card{background:linear-gradient(160deg, rgba(16,185,129,.22), rgba(15,118,110,.12)); border:1px solid rgba(16,185,129,.3); border-radius:20px; padding:1.6rem; box-shadow:0 20px 40px rgba(0,0,0,.35); max-width:320px; justify-self:center; text-align:center}
    .hero-card h2{margin:.2rem 0 .5rem; font-size:1.4rem}
    .hero-card .hero-chip{display:inline-block; padding:.4rem 1rem; background:rgba(15,15,16,.65); border-radius:999px; font-size:.75rem; letter-spacing:.6px; text-transform:uppercase; color:var(--proto); font-weight:800}
    .hero-sub{margin:0; color:var(--muted)}

    .filter-bar{max-width:720px; margin:0 auto; padding:0 1rem 1rem; display:flex; gap:.5rem; overflow-x:auto; scrollbar-width:none}
    .filter-bar::-webkit-scrollbar{display:none}
    .filter{background:#1b1c20; color:var(--text); border:1px solid rgba(255,255,255,.08); border-radius:999px; padding:.55rem 1.2rem; font-weight:600; cursor:pointer; transition:all .2s}
    .filter:hover{border-color:rgba(16,185,129,.5); color:#9ef8cf}
    .filter.active{background:var(--accent); color:#03160f}

    #feed{max-width:720px; margin:0 auto; padding:0 0 6rem}

    .card{position:relative; margin:12px; border-radius:18px; overflow:hidden; background:var(--card); box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .media{aspect-ratio:9/16; width:100%; display:block; object-fit:cover; background:#0b0b0c}

    .overlay{position:absolute; inset:0; display:flex; align-items:flex-end; justify-content:space-between; pointer-events:none; padding:16px; background:linear-gradient(180deg, rgba(0,0,0,0) 45%, rgba(0,0,0,.45) 70%, rgba(0,0,0,.78) 95%)}
    .meta{pointer-events:auto; max-width:70%}
    .title{font-weight:800; font-size:1.05rem; margin:4px 0 2px}
    .subtitle{margin:0; font-size:.88rem; color:var(--muted)}
    .pill-row{display:flex; flex-wrap:wrap; gap:.4rem}
    .pill{background:rgba(15,118,110,.35); border:1px solid rgba(16,185,129,.6); border-radius:999px; padding:.25rem .7rem; font-size:.7rem; font-weight:700; letter-spacing:.2px; text-transform:uppercase; color:#afffe0}
    .price-row{display:flex; align-items:baseline; gap:.5rem; margin-top:.35rem}
    .price-current{font-size:1.05rem; font-weight:800; color:var(--accent)}
    .price-old{font-size:.9rem; color:var(--muted); text-decoration:line-through}
    .trust-row{display:flex; gap:.5rem; margin-top:.35rem; font-size:.7rem; letter-spacing:.4px; color:#b3f0d8; text-transform:uppercase}

    .actions{display:flex; flex-direction:column; gap:10px; align-items:flex-end; pointer-events:auto}
    .btn{border:none; border-radius:999px; padding:10px 14px; cursor:pointer; font-weight:800; display:inline-flex; align-items:center; gap:8px}
    .btn.like{background:#222; color:#fff}
    .btn.like.liked{background:var(--danger)}
    .btn.shop{background:var(--accent); color:#05130f; text-decoration:none}
    .btn.detail{background:rgba(255,255,255,.12); color:var(--text); text-decoration:none; border:1px solid rgba(255,255,255,.2)}
    .count{opacity:.9}

    .shimmer{position:absolute; inset:0; background:linear-gradient(110deg, rgba(255,255,255,0) 20%, rgba(255,255,255,.06) 45%, rgba(255,255,255,0) 70%); background-size:200% 100%; animation:shimmer 1.6s infinite}
    @keyframes shimmer{0%{background-position:200% 0} 100%{background-position:-200% 0}}

    .sentinel{height:1px}

    .ribbon{position:absolute; top:12px; left:-42px; transform:rotate(-35deg); background:rgba(245,158,11,.9); color:#111; font-weight:900; letter-spacing:.5px; padding:6px 56px; box-shadow:0 8px 24px rgba(0,0,0,.35); text-transform:uppercase; font-size:.75rem; pointer-events:none}

    .disclosure{max-width:720px; margin:0 auto 4rem; padding:1.5rem 1rem 0; font-size:.85rem; color:var(--muted); text-align:center; border-top:1px solid rgba(255,255,255,.08)}

    @media(min-width:820px){body{background:radial-gradient(80% 60% at 50% -10%, #1a1b1f 0%, #0f0f10 60%)} #feed{padding-top:8px}}
    @media(min-width:960px){.hero{grid-template-columns:1.4fr 1fr}}
  </style>
</head>
<body>
  <header>
    <div class="logo">üöÄ Schopen Feed Prototype</div>
    <div class="proto-tag">PROTOTYPE</div>
    <div class="badge">AWIN Preview ‚Ä¢ Infinite Product Discovery</div>
  </header>

  <section class="hero" aria-label="Prototype introduction">
    <div class="hero-content">
      <h1>Authentische Social-Commerce Experience</h1>
      <p>Demonstriert ein TikTok-√§hnliches Shopping-Feed-Erlebnis mit Affiliate-konformen Produktkarten, AWIN-Klicktracking und responsiver Performance. Ideal als Proof f√ºr Partner und Creator Programme.</p>
      <ul class="hero-highlights" aria-label="Feature highlights">
        <li>‚úîÔ∏è AWIN Trackinglinks &amp; Affiliate Disclosure</li>
        <li>‚úîÔ∏è Live-Like Interaktion &amp; Pull-to-Refresh</li>
        <li>‚úîÔ∏è Schnelle Medien-Ladezeiten &amp; Mobile-First UI</li>
      </ul>
    </div>
    <div class="hero-card" aria-hidden="true">
      <span class="hero-chip">Creator Preview</span>
      <h2>‚ÄûSwipe, entdecke &amp; shoppe‚Äú</h2>
      <p class="hero-sub">Produktstories mit Brand, Rabatt &amp; Trust-Signals.</p>
    </div>
  </section>

  <nav class="filter-bar" aria-label="Kategorien">
    <button class="filter active" type="button" data-filter="all">Alle</button>
    <button class="filter" type="button" data-filter="beauty">Beauty</button>
    <button class="filter" type="button" data-filter="tech">Tech</button>
    <button class="filter" type="button" data-filter="fashion">Fashion</button>
    <button class="filter" type="button" data-filter="home">Home</button>
  </nav>

  <main id="feed" aria-live="polite" aria-busy="false"></main>
  <div id="sentinel" class="sentinel" aria-hidden="true"></div>

  <template id="card-template">
    <article class="card" data-id="">
      <div class="ribbon">PROTOTYPE</div>
      <img class="media" loading="lazy" alt="Prototype product image" src="" />
      <div class="shimmer" aria-hidden="true"></div>
      <div class="overlay">
        <div class="meta">
          <div class="pill-row"></div>
          <h3 class="title"></h3>
          <p class="subtitle"></p>
          <div class="price-row"></div>
          <div class="trust-row" aria-hidden="true">
            <span class="trust">‚úì AWIN verifiziert</span>
            <span class="trust">üöö Gratis Versand</span>
          </div>
        </div>
        <div class="actions">
          <button class="btn like" type="button" aria-pressed="false" title="Prototype Like">
            <span class="heart">‚ù§</span>
            <span class="count">0</span>
          </button>
          <a class="btn shop" href="#" target="_blank" rel="noopener sponsored" title="Prototype Shop">Jetzt bei Partner shoppen</a>
          <a class="btn detail" href="#" target="_blank" rel="noopener" title="Produktstory">Story ansehen</a>
        </div>
      </div>
    </article>
  </template>

  <script>
    // --- PROTOTYPE Reliability Loader ---
    const BATCH_SIZE = 8;
    const MAX_ITEMS = 200; // safety limit (PROTOTYPE)
    const CONCURRENCY = 4; // limit simultaneous image loads
    const LOAD_TIMEOUT_MS = 8000; // per attempt
    const RETRIES = 3;

    // Smaller images (faster & more reliable for mobile) ~ 480x853 (9:16)
    const PRODUCT_IMAGES = [
      'https://images.unsplash.com/photo-1512496015851-a90fb38ba796?w=480&h=853&fit=crop&auto=format&q=70', // sneakers
      'https://images.unsplash.com/photo-1510433204899-3d2f8b31a8be?w=480&h=853&fit=crop&auto=format&q=70', // watch
      'https://images.unsplash.com/photo-1511385348-a52b4a160dc2?w=480&h=853&fit=crop&auto=format&q=70', // headphones
      'https://images.unsplash.com/photo-1522335789203-aabd1fc54bc9?w=480&h=853&fit=crop&auto=format&q=70', // skincare
      'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=480&h=853&fit=crop&auto=format&q=70', // shoes close
      'https://images.unsplash.com/photo-1522312346375-d1a52e2b99b3?w=480&h=853&fit=crop&auto=format&q=70', // camera
      'https://images.unsplash.com/photo-1517336714731-489689fd1ca8?w=480&h=853&fit=crop&auto=format&q=70', // laptop
      'https://images.unsplash.com/photo-1491553895911-0055eca6402d?w=480&h=853&fit=crop&auto=format&q=70', // hoodie
      'https://images.unsplash.com/photo-1511988617509-a57c8a288659?w=480&h=853&fit=crop&auto=format&q=70', // perfume
      'https://images.unsplash.com/photo-1516382799247-87df94b99a83?w=480&h=853&fit=crop&auto=format&q=70', // backpack
      'https://images.unsplash.com/photo-1519741497674-611481863552?w=480&h=853&fit=crop&auto=format&q=70'  // sunglasses
    ];

    const AWIN_PARTNER_ID = 'awinmid=0000&awinaffid=000000&clickref=schopen-prototype';
    const AWIN_TRACKING_BASE = 'https://www.awin1.com/cread.php?';

    const PRODUCT_DATA = [
      {
        title: 'Glow Ritual Vitamin C Serum',
        subtitle: '30ml ‚Ä¢ vegan ‚Ä¢ dermatologisch getestet',
        price: 39.9,
        oldPrice: 49.9,
        category: 'beauty',
        tags: ['Vitamin C', 'Clean Beauty'],
        shop: `${AWIN_TRACKING_BASE}${AWIN_PARTNER_ID}&ued=https://partner.example/serum`,
        story: 'https://partner.example/serum-story',
        image: PRODUCT_IMAGES[3]
      },
      {
        title: 'Aurora Noise Cancelling Headphones',
        subtitle: 'ANC ‚Ä¢ 30h Akku ‚Ä¢ USB-C Fast Charge',
        price: 189.0,
        oldPrice: 229.0,
        category: 'tech',
        tags: ['Top Seller', 'Hi-Res'],
        shop: `${AWIN_TRACKING_BASE}${AWIN_PARTNER_ID}&ued=https://partner.example/headphones`,
        story: 'https://partner.example/headphones-story',
        image: PRODUCT_IMAGES[2]
      },
      {
        title: 'Momentum Knit Sneaker',
        subtitle: 'Atmungsaktiv ‚Ä¢ recycelte Materialien',
        price: 89.95,
        oldPrice: 119.95,
        category: 'fashion',
        tags: ['-25%', 'Neu'],
        shop: `${AWIN_TRACKING_BASE}${AWIN_PARTNER_ID}&ued=https://partner.example/sneaker`,
        story: 'https://partner.example/sneaker-story',
        image: PRODUCT_IMAGES[0]
      },
      {
        title: 'FocusPro Creator Laptop 14"',
        subtitle: 'OLED ‚Ä¢ 32GB RAM ‚Ä¢ 1TB SSD',
        price: 1699.0,
        oldPrice: 1899.0,
        category: 'tech',
        tags: ['Creator Choice', 'OLED'],
        shop: `${AWIN_TRACKING_BASE}${AWIN_PARTNER_ID}&ued=https://partner.example/laptop`,
        story: 'https://partner.example/laptop-story',
        image: PRODUCT_IMAGES[6]
      },
      {
        title: 'Skylight Smart Diffuser',
        subtitle: 'App Control ‚Ä¢ Ambient Glow',
        price: 59.0,
        oldPrice: 79.0,
        category: 'home',
        tags: ['Aromatherapy', 'Smart Home'],
        shop: `${AWIN_TRACKING_BASE}${AWIN_PARTNER_ID}&ued=https://partner.example/diffuser`,
        story: 'https://partner.example/diffuser-story',
        image: PRODUCT_IMAGES[9]
      }
    ];

    // Embedded fallback (SVG data URL) ‚Äì always available
    const FALLBACK = 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22480%22 height=%22853%22 viewBox=%220 0 480 853%22%3E%3Cdefs%3E%3ClinearGradient id=%22g%22 x1=%220%22 y1=%220%22 x2=%221%22 y2=%221%22%3E%3Cstop stop-color=%22%231a1b1f%22/%3E%3Cstop offset=%221%22 stop-color=%22%230f0f10%22/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill=%22url(%23g)%22 width=%22480%22 height=%22853%22/%3E%3Ctext x=%2224%22 y=%2244%22 font-family=%22system-ui,Segoe UI,Arial%22 font-size=%2230%22 fill=%22%23f59e0b%22 font-weight=%22800%22%3EPROTOTYPE%3C/text%3E%3C/svg%3E';

    const feed = document.getElementById('feed');
    const sentinel = document.getElementById('sentinel');
    const tpl = document.getElementById('card-template');

    const likeKey = (id) => `prototype_feed_like_${id}`;
    const getLiked = (id) => localStorage.getItem(likeKey(id)) === '1';
    const setLiked = (id, v) => localStorage.setItem(likeKey(id), v ? '1' : '0');

    let loaded = 0;
    let busy = false;
    let activeFilter = 'all';

    function pickImage(i){
      return PRODUCT_IMAGES[i % PRODUCT_IMAGES.length];
    }

    function waitFor(img){
      return new Promise((resolve, reject)=>{
        const onLoad = ()=>{ cleanup(); resolve(); };
        const onErr = ()=>{ cleanup(); reject(new Error('img error')); };
        const cleanup = ()=>{ img.removeEventListener('load', onLoad); img.removeEventListener('error', onErr); };
        img.addEventListener('load', onLoad, {once:true});
        img.addEventListener('error', onErr, {once:true});
        if(img.complete && img.naturalWidth>0){ cleanup(); resolve(); }
      });
    }

    async function loadImageWithRetry(imgEl, url){
      for(let attempt=1; attempt<=RETRIES; attempt++){
        const cacheBust = (attempt>1) ? (url + (url.includes('?')?'&':'?') + 't=' + Date.now()) : url;
        imgEl.src = cacheBust;
        try{
          await Promise.race([
            waitFor(imgEl),
            new Promise((_,rej)=>setTimeout(()=>rej(new Error('timeout')), LOAD_TIMEOUT_MS))
          ]);
          return true; // loaded
        }catch(e){
          // try next attempt
        }
      }
      imgEl.src = FALLBACK; // final fallback
      return false;
    }

    // Queue to limit concurrent image loads
    const queue = [];
    let active = 0;
    function enqueue(task){
      queue.push(task); pump();
    }
    function pump(){
      while(active < CONCURRENCY && queue.length){
        const t = queue.shift(); active++;
        t().finally(()=>{ active--; pump(); });
      }
    }

    function formatCurrency(amount){
      return new Intl.NumberFormat('de-CH', { style: 'currency', currency: 'CHF' }).format(amount);
    }

    function createCard(item){
      const node = tpl.content.firstElementChild.cloneNode(true);
      node.dataset.id = item.id;
      const img = node.querySelector('.media');
      const shimmer = node.querySelector('.shimmer');
      node.querySelector('.title').textContent = item.title;
      node.querySelector('.subtitle').textContent = item.subtitle;

      const priceRow = node.querySelector('.price-row');
      priceRow.innerHTML = `
        <span class="price-current">${formatCurrency(item.price)}</span>
        ${item.oldPrice ? `<span class="price-old">${formatCurrency(item.oldPrice)}</span>` : ''}
      `;

      const pillRow = node.querySelector('.pill-row');
      pillRow.innerHTML = '';
      item.tags.forEach(tag => {
        const span = document.createElement('span');
        span.className = 'pill';
        span.textContent = tag;
        pillRow.appendChild(span);
      });

      const likeBtn = node.querySelector('.like');
      const countEl = likeBtn.querySelector('.count');
      const initiallyLiked = getLiked(item.id);
      likeBtn.classList.toggle('liked', initiallyLiked);
      likeBtn.setAttribute('aria-pressed', initiallyLiked ? 'true' : 'false');
      let count = initiallyLiked ? item.likes + 1 : item.likes;
      countEl.textContent = count;
      likeBtn.addEventListener('click', () => {
        const now = !likeBtn.classList.contains('liked');
        likeBtn.classList.toggle('liked', now);
        likeBtn.setAttribute('aria-pressed', now ? 'true' : 'false');
        setLiked(item.id, now);
        count += now ? 1 : -1;
        countEl.textContent = count;
      });

      // Lazy-load via IntersectionObserver + retry with fallback
      img.dataset.src = item.img; // store target URL
      const io = new IntersectionObserver(async (entries, obs)=>{
        for(const entry of entries){
          if(entry.isIntersecting){
            obs.unobserve(img);
            enqueue(async ()=>{
              try{ await loadImageWithRetry(img, img.dataset.src); }
              finally{ shimmer && shimmer.remove(); }
            });
          }
        }
      }, {rootMargin:'600px'});
      io.observe(img);

      // Also set a temporary fallback immediately (so nothing looks broken before load)
      img.src = FALLBACK;

      const shop = node.querySelector('.shop');
      shop.href = item.shop;
      shop.textContent = 'Jetzt shoppen ‚Äì AWIN';

      const detail = node.querySelector('.detail');
      detail.href = item.story;
      detail.textContent = 'Produktstory';

      return node;
    }

    function makeItem(i){
      const base = PRODUCT_DATA[i % PRODUCT_DATA.length];
      const id = `${base.category}-${i.toString(36)}`;
      return {
        id,
        title: base.title,
        subtitle: base.subtitle,
        price: base.price,
        oldPrice: base.oldPrice,
        category: base.category,
        tags: base.tags,
        img: base.image || pickImage(i),
        likes: Math.floor(Math.random()*120) + 20,
        shop: base.shop,
        story: base.story
      };
    }

    function loadBatch(filter = activeFilter){
      if(busy) return; busy = true; feed.setAttribute('aria-busy','true');
      const frag = document.createDocumentFragment();
      let added = 0;
      while(added < BATCH_SIZE && loaded < MAX_ITEMS){
        const idx = loaded + 1;
        const item = makeItem(idx);
        loaded++;
        if(filter !== 'all' && item.category !== filter){
          continue;
        }
        frag.appendChild(createCard(item));
        added++;
      }
      if(added){
        feed.appendChild(frag);
      }
      feed.setAttribute('aria-busy','false'); busy = false;
    }

    // Infinite Scroll sentinel
    const io = new IntersectionObserver(entries => {
      entries.forEach(entry => { if(entry.isIntersecting) loadBatch(); });
    }, {rootMargin: '1200px'});
    io.observe(sentinel);
    loadBatch(); // initial (PROTOTYPE)

    // Pull-to-refresh (mobile): soft refresh of images (retries)
    let touchStartY = 0;
    window.addEventListener('touchstart', (e)=>{ touchStartY = e.touches[0].clientY; }, {passive:true});
    window.addEventListener('touchend', ()=>{
      if(window.scrollY===0 && touchStartY<50){
        document.querySelectorAll('.card .media').forEach((img)=>{
          const url = img.dataset && img.dataset.src; if(!url) return;
          enqueue(async ()=>{ await loadImageWithRetry(img, url); });
        });
      }
    }, {passive:true});

    // Filtering logic
    const filterButtons = document.querySelectorAll('.filter');
    filterButtons.forEach(btn => {
      btn.setAttribute('aria-pressed', btn.classList.contains('active') ? 'true' : 'false');
      btn.addEventListener('click', () => {
        if(btn.dataset.filter === activeFilter) return;
        filterButtons.forEach(b => {
          const isActive = b === btn;
          b.classList.toggle('active', isActive);
          b.setAttribute('aria-pressed', isActive ? 'true' : 'false');
        });
        activeFilter = btn.dataset.filter;
        feed.innerHTML = '';
        loaded = 0;
        loadBatch();
      });
    });

    // Affiliate disclosure footer
    const disclosure = document.createElement('footer');
    disclosure.className = 'disclosure';
    disclosure.innerHTML = `
      <strong>Affiliate Hinweis:</strong> Diese Prototype-Ansicht nutzt <abbr title="Affiliate Window">AWIN</abbr>-Trackinglinks. K√§ufe √ºber diese Links k√∂nnen zu Provisionen f√ºhren.
    `;
    document.body.appendChild(disclosure);
  </script>
</body>
</html>
